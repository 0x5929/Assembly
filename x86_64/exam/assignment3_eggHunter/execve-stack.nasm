; File: execve-stack.nasm
; Author: Kevin Ren, originally professor Viviek of SLAE64
; Purpose: shellcode a execve shellcode to spawn a shell using the stack method


global _start

section .text
_start: 
	; zero out registers
	xor rax, rax
	xor rbx, rbx

	; execve syscall (#59)
	mov al, 59		
	
	; execve arguments
	push rbx					; pushing NULL (zeros)
	mov rcx, 0x68732f2f6e69622f			; pushing /bin//sh in reverse hex
	push rcx 
	mov rdi, rsp					; filename /bin//sh (1st arg)

	push rbx					; pushing NULL
	push rdi					; push address of /bin//sh00000000
	mov rsi, rsp					; argv[/bin//sh00000000, 00000000] (2nd arg)

	push rbx					; pushing NULL
	mov rdx, rsp					; envp[00000000] (3rd arg)

	; NOTE: could have just pushed NULL, /bin//sh [first arg], NULL [third arg], /bin//shNULL (first arg) [second arg]

	syscall
